<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-element.html">
<link rel="import" href="../../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../../bower_components/font-roboto/roboto.html">

<link rel="import" href="../game-board/game-board.html">

<polymer-element name="game-app" attributes="">
  <template>
    <link rel="stylesheet" href="game-app.css">

    <firebase-element id="base"
                      on-data-change="{{dataChange}}"
                      data="{{rooms}}"
                      location="https://seabattle.firebaseio.com/rooms"
                      log></firebase-element>

    <core-header-panel fit>
      <core-toolbar>
        <div flex>seabattle</div>
      </core-toolbar>

      <div class="content">
        <template repeat="{{room, id in rooms}}">
          <paper-shadow class="card" horizontal layout>
            <div flex vertical layout>
              <div>{{room.player1.name}}</div>
              <game-board board="{{room.player1.board}}"></game-board>
            </div>
            <div flex vertical layout>
              <div>{{room.player2.name}}</div>
              <game-board board="{{room.player2.board}}"></game-board>
            </div>
          </paper-shadow>
        </template>
      </div>

      <paper-fab icon="add" on-click="{{createRoom}}"></paper-fab>
    </core-header-panel>
  </template>
  <script>
    (function () {
      Polymer({
        ready: function () {
        },

        dataChange: function () {
        },

        createRoom: function () {
          var room = {
            player1: {
              name: 'player1',
              board: {}
            },
            player2: {
              name: 'player2',
              board: {}
            }
          };
          for (var x = 1; x <= 10; x++) {
            room.player1.board[x] = [];
            room.player2.board[x] = [];
            for (var y = 1; y <= 10; y++) {
              room.player1.board[x][y] = y;
              room.player2.board[x][y] = y;
            }
          }

          var id = 0;
          if (this.rooms) {
            for (var i in this.rooms) {
              id = Math.max(i, id);
            }
            id += 1;
          }

          new Firebase('https://seabattle.firebaseio.com/rooms/' + id).set(room);
        }
      });

    })();
  </script>
</polymer-element>
